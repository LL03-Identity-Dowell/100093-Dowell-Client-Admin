{% load static %}

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Product Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="{%static 'clientadmin/css/style.css' %}" />
   		<script>
			let searchedMEmberArray = [];
$(function () {
  // Fetch member names from the API
  async function fetchMemberNames() {
    const requestBody = {
      username: "Testing_40045",
      password: "dowell12345",
    };

    try {
      const response = await fetch("https://100014.pythonanywhere.com/api/all_users/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(requestBody),
      });

      if (!response.ok) {
        throw new Error("Failed to fetch member names");
      }

      const data = await response.json();
      return data.data.map((item) => item.member_name);
    } catch (error) {
      console.error("Error fetching member names:", error);
      return [];
    }
  }

  async function initializeAutocomplete() {
    const memberNames = await fetchMemberNames();

    let searchedMEmberArray = [];

    $("#tags").autocomplete({
      source: memberNames,
      select: function (event, ui) {
        var selectedValue = ui.item.value;
        $("#selectMembers").empty();

        searchedMEmberArray.push(selectedValue);

        searchedMEmberArray = [...new Set(searchedMEmberArray)];
        console.log(searchedMEmberArray);
        for (let i = 0; i < searchedMEmberArray.length; i++) {
          var option = document.createElement("option");
          option.text = searchedMEmberArray[i];
          option.value = searchedMEmberArray[i];
          var select = document.getElementById("selectMembers");
          select.appendChild(option);
        }
      },
    });
    $("#tags1").autocomplete({
      source: memberNames,
    });
  }

  initializeAutocomplete();
});

		</script>
	</head>
<body>
		<div class="dowell-form-wrapper">
			<div class="container mt-5">
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6">
						<div class="card">
							<div class="card-title p-3 text-center">
								<h2>Product Update</h2>
							</div>
							<div class="card-body">
								<form action="" method="POST" enctype='multipart/form-data'>
                					{% csrf_token %}
								<div class="mb-3">
									<label for="product" class="form-label">Product</label>
									<select class="form-select" id="product" name="product">
                                	    {% for product in products %}
                                    <option value="{{ product.product_name }}">{{ product.product_name }}</option>
                                        {% endfor %}
									</select>
								</div>
								<div class="mb-3 ui-widget">
									<label for="tags" class="form-label">Member Search</label>
									<input
										type="text"
										onchange="addMember()"
										class="form-control"
										id="tags"
										placeholder="Member Search"
									/>
								</div>
								<div class="mb-3">
									<label for="selectMembers" class="form-label">Members</label>
									<select class="form-select" multiple id="selectMembers" name="members">
										<!-- <option selected>Member 1</option>
                                 <option value="2">Member 2</option>
                                 <option value="3">Member 3</option>
                                 <option value="4">Member 4</option>
                                 <option value="5">Member 5</option> -->
									</select>
								</div>
																<div class="mb-3">
    <label class="form-label">Member Type</label>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="member_type" id="paid_members" value="paid">
        <label class="form-check-label" for="paid_members">
            Paid Members
        </label>
    </div>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="member_type" id="unpaid_members" value="unpaid">
        <label class="form-check-label" for="unpaid_members">
            Unpaid Members
        </label>
    </div>
    <!--<div class="form-check">-->
    <!--    <input class="form-check-input" type="radio" name="member_type" id="members" value="member" checked>-->
    <!--    <label class="form-check-label" for="members">-->
    <!--        Members-->
    <!--    </label>-->
    <!--</div>-->
</div>
								<div class="mb-3">
									<button type="submit" class="btn btn-success" name="submitForProducts">Update</button>
								</div>
								<div class="mb-3">
									<label for="tags1" class="form-label">Members</label>
									<input
										type="text"
										class="form-control"
										id="tags1"
										placeholder="Member Search"
									/>
								</div>
								<div class="mb-3">
									<label for="product" class="form-label">Product</label>
									<select class="form-select" multiple id="product" name="products">
					      	    {% for product in products %}
                                    <option value="{{ product.product_name }}">{{ product.product_name }}</option>
                                        {% endfor %}
									</select>
								</div>

								<div class="mb-3">
									<button type="submit" class="btn btn-success" name="submitForClientAdmin">Update</button>
								</div>
								</form>
							</div>
						</div>
					</div>
					<div class="col-md-3"></div>
				</div>
			</div>
		</div>
		<script src="./js/script.js"></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
			crossorigin="anonymous"
		></script>
	</body>
</html>